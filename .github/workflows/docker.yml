name: docker
on:
    - push
jobs:
    makefile:
        runs-on: ubuntu-latest
        steps:
            - {name: Checkout, uses: actions/checkout@v2}
            - {name: 'Show HELP', run: 'make help'}
            - {name: 'Docker swarm init', run: 'docker swarm init --default-addr-pool 10.20.0.0/16'}
            - {name: 'récupération des images', run: 'make docker-image-pull'}
            - {name: 'Create proxy network', run: 'make docker-create-network'}
            - {name: 'Build containers', run: 'make docker-deploy'}
            - {name: 'Check running stack', run: 'docker stack ls'}
            - {name: 'Make sleep', run: 'make sleep'}
            - {name: 'Installation version PROD', run: 'make env-prod'}
            - {name: 'Check running containers', run: 'docker service ls'}
            - {name: 'BDD MIGRATE', run: 'make bdd-migrate'}
            - {name: 'BDD MIGRATE', run: 'make bdd-validate'}
            # - {name: 'Run the fixtures', run: 'make bdd-fixtures'}